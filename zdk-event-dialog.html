<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-dialog/paper-action-dialog.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../core-icon/core-icon.html">
<link rel="import" href="../paper-input/paper-input-decorator.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../core-collapse/core-collapse.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../cg-datetime-picker/cg-datetime-input.html">
<script src="../momentjs/min/moment-with-locales.min.js"></script>

<polymer-element name="zdk-event-dialog" attributes="event">
    <template>
        <style>
            :host .colored {
            color: #4285f4;
            }
            :host paper-action-dialog {
                width:400px;
                max-width:400px;
            }
        </style>
        <paper-action-dialog heading="{{heading}}" backdrop autoCloseDisabled layered="false" name="{{id}}">
            <section>
                <div vertical layout class="event-form">
                    <paper-input-decorator label="Label" floatingLabel error="input is required!" autoValidate>
                        <input is="core-input" required value="{{_editCopy.label}}">
                    </paper-input-decorator>
                    <cg-datetime-input datetime="{{_editCopy.start}}" label="From"></cg-datetime-input>
                    <cg-datetime-input datetime="{{_editCopy.end}}" label="To"></cg-datetime-input>
                    <paper-input-decorator label="Notes" floatingLabel>
                        <paper-autogrow-textarea>
                            <textarea value="{{_editCopy.notes}}"></textarea>
                        </paper-autogrow-textarea>
                    </paper-input-decorator>
                </div>
            </section>
            <paper-button affirmative class="colored custom" on-tap="{{ok}}">
                <core-icon icon="check"></core-icon>
                <template if="{{ !create }}">ok</template>
                <template if="{{ create }}">add</template>
            </paper-button>
            <paper-button dismissive class="custom" on-tap="{{cancel}}">
                <core-icon icon="clear"></core-icon>
                cancel
            </paper-button>
            <template if="{{ !create }}">
                <paper-button dismissive class="custom" on-tap="{{delete}}">
                    <core-icon icon="clear"></core-icon>
                    delete
                </paper-button>
            </template>
        </paper-action-dialog>
    </template>
    <script>
        Polymer('zdk-event-dialog', {
            event:null,
            heading:"",
            existingEvent:"Edit event",
            addEvent:"Add event",
            create:false,
            _editCopy:null,
            domReady:function() {
                this.dialog = this.querySelector(':host /deep/ paper-action-dialog');
            },
            ok:function(){
                this._copyProps(this._editCopy, this.event);
                this.closeDialog("OK");
            },
            cancel:function(){
                this.closeDialog("CANCEL");
            },
            delete:function(){
                this.closeDialog("DELETE");
            },
            eventChanged:function(){
                this._editCopy = this._extractProps(this.event, ["label", "start", "end", "notes"]);
            },
            openDialog:function(event){
                this.create = event === undefined;
                this.event = this.create ? {
                    allDay:false,
                    className:"event1",
                    recurring:false
                } : event;
                this.heading = this.create ? this.addEvent : this.existingEvent;
                this.dialog.toggle();
            },
            closeDialog:function(result){
                this.dialog.open = false;
                this.fire("zdk-event-dialog-close", {
                    event: this.event,
                    result: result
                });
            },
            _copyProps:function(src, dest, props){
                props.forEach(function(prop){
                    dest[prop] = src[prop];
                });
            },
            _extractProps:function(a, props){
                var extract = {};
                this._copyProps(a, extract, props);
                return extract;
            },
        });
    </script>
</polymer-element>